---
version: '1.0'
description: >
  Handles an inbound webhook
input:
  - messageId
  - roomId
tasks:
  get_message:
    action: cisco_spark.get_message
    input:
      messageId: <% ctx().messageId %>
    next:
      - when: <% succeeded() and result().result.roomType = 'direct' %>
        publish:
          - text: <% result().result.text %>
        do:
          - direct_room
      - when: <% succeeded() and result().result.roomType = 'group' %>
        publish:
          - text: <% result().result.text %>
        do:
          - group_room
  group_room:
    action: chatops.run
    input:
      text: <% regex_replace(ctx().text, "^[^\\s]+", "") %>
      channel: <% ctx().roomId %>
  direct_room:
    action: chatops.run
    input:
      text: <% ctx().text %>
      channel: <% ctx().roomId %>
